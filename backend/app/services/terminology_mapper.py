"""
SajuOS ìš©ì–´ ì¹˜í™˜ ë ˆì´ì–´
- ëª…ë¦¬í•™ ìš©ì–´ â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ì–¸ì–´ 100% ì¹˜í™˜
- í”„ë¡¬í”„íŠ¸ ë ˆë²¨ + í›„ì²˜ë¦¬ ë ˆë²¨ ì´ì¤‘ ë°©ì–´

ê¸ˆì¹™ì–´ ì •ì±…:
- ì‚¬ì£¼ ì›êµ­ ì¹´ë“œ(ìƒë‹¨ í‘œ): ì›ì–´ í—ˆìš© (ç”²ä¹™ä¸™ä¸ ë“±)
- ì»¨ì„¤íŒ… ì„¹ì…˜ ë³¸ë¬¸: 100% ê¸ˆì§€ ë° ì¹˜í™˜
"""
import re
from typing import Dict, List, Tuple


# ============ ìš©ì–´ ì¹˜í™˜ ì‚¬ì „ ============

# ì‹­ì„±(åæ˜Ÿ) â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ê°œë…
SIPSUNG_MAP: Dict[str, List[str]] = {
    # ë¹„ê²(æ¯”åŠ«) - ê²½ìŸ/íŒŒíŠ¸ë„ˆ
    "ë¹„ê²": ["ê²½ìŸ êµ¬ë„", "ì‹œì¥ ê²½ìŸ", "íŒŒíŠ¸ë„ˆì‹­ ì—­í•™", "ë™ì¢… ì—…ê³„ ê²½ìŸ"],
    "ë¹„ê²¬": ["ë™ê¸‰ ê²½ìŸì", "íŒŒíŠ¸ë„ˆ", "í˜‘ë ¥ ë„¤íŠ¸ì›Œí¬", "ë™ë£Œ ìì›"],
    "ê²ì¬": ["ê³µê²©ì  ê²½ìŸ", "ì‹œì¥ ì ì‹ ë¦¬ìŠ¤í¬", "ë‚´ë¶€ ê°ˆë“± ìš”ì¸", "ìì› ê²½ìŸ"],
    
    # ì¸ì„±(å°æ˜Ÿ) - ì§€ì‹/ë¸Œëœë“œ
    "ì¸ì„±": ["ì§€ì‹ ìì‚°", "IP í¬íŠ¸í´ë¦¬ì˜¤", "ë¸Œëœë“œ ì‹ ë¢°ë„", "í•™ìŠµ ì—­ëŸ‰"],
    "ì •ì¸": ["í•µì‹¬ IP", "ê³µì¸ ìê²©", "ì•ˆì •ì  ë¸Œëœë“œ", "ì¶•ì ëœ ë…¸í•˜ìš°"],
    "í¸ì¸": ["í˜ì‹  ê¸°ìˆ ", "ë¹„ê³µì‹ ë„¤íŠ¸ì›Œí¬", "ì°½ì˜ì  ìì‚°", "ì ì¬ ì—­ëŸ‰"],
    
    # ì¬ì„±(è²¡æ˜Ÿ) - í˜„ê¸ˆíë¦„/ìì‚°
    "ì¬ì„±": ["í˜„ê¸ˆíë¦„", "ìœ ë™ì„±", "ë§¤ì¶œ êµ¬ì¡°", "ìì‚° í¬íŠ¸í´ë¦¬ì˜¤"],
    "ì •ì¬": ["ì•ˆì • ìˆ˜ìµì›", "ì •ê¸° ë§¤ì¶œ", "í•µì‹¬ ìì‚°", "ì˜ˆì¸¡ ê°€ëŠ¥ í˜„ê¸ˆíë¦„"],
    "í¸ì¬": ["ì‹ ê·œ ìˆ˜ìµ ê¸°íšŒ", "ë³€ë™ ë§¤ì¶œ", "íˆ¬ì ìˆ˜ìµ", "ê³ ìœ„í—˜ ê³ ìˆ˜ìµ ìì‚°"],
    
    # ê´€ì„±(å®˜æ˜Ÿ) - ì‹œìŠ¤í…œ/ì»´í”Œë¼ì´ì–¸ìŠ¤
    "ê´€ì„±": ["ì¡°ì§ ì‹œìŠ¤í…œ", "ê·œì • ì¤€ìˆ˜", "ë¦¬ìŠ¤í¬ ê´€ë¦¬", "ê±°ë²„ë„ŒìŠ¤"],
    "ì •ê´€": ["ê³µì‹ ì‹œìŠ¤í…œ", "ë²•ì  í”„ë ˆì„ì›Œí¬", "ì•ˆì •ì  í†µì œ", "ì»´í”Œë¼ì´ì–¸ìŠ¤"],
    "í¸ê´€": ["ì™¸ë¶€ ì••ë ¥", "ê·œì œ ë¦¬ìŠ¤í¬", "ë¶ˆí™•ì‹¤ì„±", "ìœ„ê¸° ê´€ë¦¬ í•„ìš”"],
    "ì¹ ì‚´": ["ì‹¬ê°í•œ ìœ„í˜‘", "êµ¬ì¡°ì  ë¦¬ìŠ¤í¬", "ê¸´ê¸‰ ëŒ€ì‘ í•„ìš”", "ìœ„ê¸° ì‹œë‚˜ë¦¬ì˜¤"],
    
    # ì‹ìƒ(é£Ÿå‚·) - ì‹¤í–‰/ìƒì‚°
    "ì‹ìƒ": ["ì‹¤í–‰ë ¥", "ìƒì‚°ì„±", "ì•„ì›ƒí’‹", "ì‹œì¥ ì§„ì¶œ ì—­ëŸ‰"],
    "ì‹ì‹ ": ["ì•ˆì •ì  ìƒì‚°", "í’ˆì§ˆ ê´€ë¦¬", "ì§€ì† ê°€ëŠ¥í•œ ì„±ê³¼", "í•µì‹¬ ì—­ëŸ‰ ë°œíœ˜"],
    "ìƒê´€": ["í˜ì‹ ì  ì¶œë ¥", "íŒŒê´´ì  í˜ì‹ ", "ê³µê²©ì  ë§ˆì¼€íŒ…", "ê³ ì„±ì¥ ì „ëµ"],
}

# ì²œê°„(å¤©å¹²) â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ì†ì„±
CHUNGAN_MAP: Dict[str, str] = {
    "ê°‘": "ì„±ì¥ ì£¼ë„í˜• ë¦¬ë”ì‹­",
    "ì„": "ìœ ì—°í•œ ì ì‘ ì „ëµ",
    "ë³‘": "í™•ì¥ì  ì‹œì¥ ê³µëµ",
    "ì •": "ì •ë°€í•œ í’ˆì§ˆ ê´€ë¦¬",
    "ë¬´": "ì•ˆì •ì  ê¸°ë°˜ êµ¬ì¶•",
    "ê¸°": "ì„¬ì„¸í•œ ê³ ê° ê´€ë¦¬",
    "ê²½": "ë‹¨í˜¸í•œ ì˜ì‚¬ê²°ì •",
    "ì‹ ": "ì •êµí•œ ì‹œìŠ¤í…œ êµ¬ì¶•",
    "ì„": "ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ í™•ì¥",
    "ê³„": "ì„¸ë°€í•œ ë¦¬ìŠ¤í¬ ê´€ë¦¬",
}

# ì§€ì§€(åœ°æ”¯) â†’ ë¹„ì¦ˆë‹ˆìŠ¤ íƒ€ì´ë°/í™˜ê²½
JIJI_MAP: Dict[str, str] = {
    "ì": "ì‹¬ì•¼/ì—°ë§ ì§‘ì¤‘ ê¸°ê°„",
    "ì¶•": "ê¸°ë°˜ ë‹¤ì§€ê¸° ì‹œê¸°",
    "ì¸": "ì„±ì¥ ê°€ì† ì‹œê¸°",
    "ë¬˜": "í™•ì¥ ë³¸ê²©í™” ì‹œê¸°",
    "ì§„": "ë³€í™” ì „í™˜ì ",
    "ì‚¬": "ìµœê³ ì¡° í¼í¬ë¨¼ìŠ¤ ì‹œê¸°",
    "ì˜¤": "ì •ì /í”¼í¬ ì‹œì¦Œ",
    "ë¯¸": "ìˆ˜í™•/ì •ì‚° ì‹œê¸°",
    "ì‹ ": "êµ¬ì¡°ì¡°ì • ì‹œê¸°",
    "ìœ ": "ìˆ˜ìµ ì‹¤í˜„ ì‹œê¸°",
    "ìˆ ": "ë§ˆë¬´ë¦¬/ì ê²€ ì‹œê¸°",
    "í•´": "ì¬ì •ë¹„/ì¤€ë¹„ ì‹œê¸°",
}

# ì˜¤í–‰(äº”è¡Œ) â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì—­
OHANG_MAP: Dict[str, str] = {
    "ëª©": "ì„±ì¥/í™•ì¥ ì˜ì—­",
    "í™”": "ë§ˆì¼€íŒ…/ë¸Œëœë”© ì˜ì—­",
    "í† ": "ìš´ì˜/ê´€ë¦¬ ì˜ì—­",
    "ê¸ˆ": "ì¬ë¬´/ìˆ˜ìµ ì˜ì—­",
    "ìˆ˜": "ì „ëµ/ê¸°íš ì˜ì—­",
    "æœ¨": "ì„±ì¥/í™•ì¥ ì˜ì—­",
    "ç«": "ë§ˆì¼€íŒ…/ë¸Œëœë”© ì˜ì—­",
    "åœŸ": "ìš´ì˜/ê´€ë¦¬ ì˜ì—­",
    "é‡‘": "ì¬ë¬´/ìˆ˜ìµ ì˜ì—­",
    "æ°´": "ì „ëµ/ê¸°íš ì˜ì—­",
}

# ê¸°íƒ€ ëª…ë¦¬í•™ ìš©ì–´ â†’ ë¹„ì¦ˆë‹ˆìŠ¤ í‘œí˜„
MISC_MAP: Dict[str, str] = {
    "ëŒ€ìš´": "ì¥ê¸° íŠ¸ë Œë“œ ì‚¬ì´í´",
    "ì„¸ìš´": "ì—°ê°„ ë¹„ì¦ˆë‹ˆìŠ¤ í™˜ê²½",
    "ì›”ìš´": "ì›”ë³„ ì‹œì¥ íë¦„",
    "ì¼ìš´": "ì¼ë³„ ì‹¤í–‰ ë¦¬ë“¬",
    "ìš©ì‹ ": "í•µì‹¬ ì„±ê³µ ìš”ì¸(CSF)",
    "í¬ì‹ ": "ë³´ì¡° ì„±ê³µ ìš”ì¸",
    "ê¸°ì‹ ": "ì£¼ìš” ë¦¬ìŠ¤í¬ ìš”ì¸",
    "êµ¬ì‹ ": "ì ì¬ì  ìœ„í˜‘ ìš”ì¸",
    "ê²©êµ­": "ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ ìœ í˜•",
    "ì‹ ê°•": "ë‚´ë¶€ ì—­ëŸ‰ ìš°ìœ„",
    "ì‹ ì•½": "ì™¸ë¶€ ìì› ì˜ì¡´",
    "ì¼ê°„": "í•µì‹¬ ì˜ì‚¬ê²°ì •ì íŠ¹ì„±",
    "ì¼ì£¼": "ë¦¬ë”ì‹­ í”„ë¡œíŒŒì¼",
    "ì›”ì£¼": "ì‚¬ì—… í™˜ê²½ íŠ¹ì„±",
    "ë…„ì£¼": "ì‹œì¥ ì§„ì… ë°°ê²½",
    "ì‹œì£¼": "ì„±ê³¼ ì°½ì¶œ íŒ¨í„´",
    "ì²œê°„": "ì „ëµì  ë°©í–¥ì„±",
    "ì§€ì§€": "ì‹¤í–‰ í™˜ê²½",
    "ê°„ì§€": "ì „ëµ-ì‹¤í–‰ ì¡°í•©",
    "ì‚¬ì£¼": "ë¹„ì¦ˆë‹ˆìŠ¤ DNA",
    "íŒ”ì": "í•µì‹¬ ì—­ëŸ‰ í”„ë¡œíŒŒì¼",
    "ëª…ë¦¬": "ë°ì´í„° ê¸°ë°˜ ë¶„ì„",
    "ìš´ì„¸": "ì‹œì¥ ì „ë§",
    "ê¸¸í‰": "ê¸°íšŒì™€ ìœ„í˜‘",
    "í•©": "ì‹œë„ˆì§€ íš¨ê³¼",
    "ì¶©": "ê°ˆë“±/ë§ˆì°° ìš”ì¸",
    "í˜•": "êµ¬ì¡°ì  ê¸´ì¥",
    "íŒŒ": "ì¼ì‹œì  ì¶©ëŒ",
    "í•´": "ì ì¬ì  ì†ì‹¤",
    "ì›ì§„": "ì¥ê¸° ê²½ìŸ ê´€ê³„",
    "ê·€ë¬¸ê´€ì‚´": "ì˜ˆì™¸ì  ë¦¬ìŠ¤í¬ ì‹œë‚˜ë¦¬ì˜¤",
    "ë„í™”": "ëŒ€ì™¸ ì´ë¯¸ì§€/PR ì—­ëŸ‰",
    "ì—­ë§ˆ": "í™•ì¥/ì´ë™/ê¸€ë¡œë²Œ ê¸°íšŒ",
    "í™”ê°œ": "ì „ë¬¸ì„±/ë‹ˆì¹˜ ë§ˆì¼“",
    "ë¬¸ì°½": "ì½˜í…ì¸ /êµìœ¡ ì—­ëŸ‰",
    "ì²œì„ê·€ì¸": "í•µì‹¬ ë©˜í† /í›„ì›ì ë„¤íŠ¸ì›Œí¬",
    "ì›”ë•ê·€ì¸": "ì•ˆì •ì  ì§€ì› ì‹œìŠ¤í…œ",
}

# ê°„ì§€ 60ê°‘ì íŒ¨í„´ (ë³¸ë¬¸ì—ì„œ ì œê±°/ì¹˜í™˜)
GANJI_60 = [
    "ê°‘ì", "ì„ì¶•", "ë³‘ì¸", "ì •ë¬˜", "ë¬´ì§„", "ê¸°ì‚¬", "ê²½ì˜¤", "ì‹ ë¯¸", "ì„ì‹ ", "ê³„ìœ ",
    "ê°‘ìˆ ", "ì„í•´", "ë³‘ì", "ì •ì¶•", "ë¬´ì¸", "ê¸°ë¬˜", "ê²½ì§„", "ì‹ ì‚¬", "ì„ì˜¤", "ê³„ë¯¸",
    "ê°‘ì‹ ", "ì„ìœ ", "ë³‘ìˆ ", "ì •í•´", "ë¬´ì", "ê¸°ì¶•", "ê²½ì¸", "ì‹ ë¬˜", "ì„ì§„", "ê³„ì‚¬",
    "ê°‘ì˜¤", "ì„ë¯¸", "ë³‘ì‹ ", "ì •ìœ ", "ë¬´ìˆ ", "ê¸°í•´", "ê²½ì", "ì‹ ì¶•", "ì„ì¸", "ê³„ë¬˜",
    "ê°‘ì§„", "ì„ì‚¬", "ë³‘ì˜¤", "ì •ë¯¸", "ë¬´ì‹ ", "ê¸°ìœ ", "ê²½ìˆ ", "ì‹ í•´", "ì„ì", "ê³„ì¶•",
    "ê°‘ì¸", "ì„ë¬˜", "ë³‘ì§„", "ì •ì‚¬", "ë¬´ì˜¤", "ê¸°ë¯¸", "ê²½ì‹ ", "ì‹ ìœ ", "ì„ìˆ ", "ê³„í•´",
]


# ============ ê¸ˆì¹™ì–´ íŒ¨í„´ ============

FORBIDDEN_PATTERNS = [
    # ì‹­ì„± ê´€ë ¨
    r'ë¹„ê²ìš´', r'ì¸ì„±ìš´', r'ì¬ì„±ìš´', r'ê´€ì„±ìš´', r'ì‹ìƒìš´',
    r'ë¹„ê²¬ì´', r'ê²ì¬ê°€', r'ì •ì¸ì´', r'í¸ì¸ì´',
    r'ì •ì¬ê°€', r'í¸ì¬ê°€', r'ì •ê´€ì´', r'í¸ê´€ì´', r'ì¹ ì‚´ì´',
    r'ì‹ì‹ ì´', r'ìƒê´€ì´',
    
    # ì˜¤í–‰ ê´€ë ¨
    r'ëª©ê¸°', r'í™”ê¸°', r'í† ê¸°', r'ê¸ˆê¸°', r'ìˆ˜ê¸°',
    r'ëª©ì˜ ê¸°ìš´', r'í™”ì˜ ê¸°ìš´', r'í† ì˜ ê¸°ìš´', r'ê¸ˆì˜ ê¸°ìš´', r'ìˆ˜ì˜ ê¸°ìš´',
    
    # ê°„ì§€ ì§ì ‘ ì–¸ê¸‰
    r'[ê°‘ì„ë³‘ì •ë¬´ê¸°ê²½ì‹ ì„ê³„][ìì¶•ì¸ë¬˜ì§„ì‚¬ì˜¤ë¯¸ì‹ ìœ ìˆ í•´](?:ë…„|ì›”|ì¼|ì‹œ)?',
    
    # ëª…ë¦¬í•™ ì „ë¬¸ í‘œí˜„
    r'ì‚¬ì£¼[ê°€ëŠ”ì„ë¥¼]', r'íŒ”ì[ê°€ëŠ”ì„ë¥¼]',
    r'ìš´ì„¸[ê°€ëŠ”ì„ë¥¼ì´]',
    r'ëª…ë¦¬í•™', r'ëª…ë¦¬ì ',
    r'ìŒì–‘ì˜¤í–‰',
    r'ì²œê°„ì§€ì§€',
    r'ëŒ€ìš´ì´', r'ì„¸ìš´ì´', r'ì›”ìš´ì´',
    r'ìš©ì‹ ì´', r'í¬ì‹ ì´', r'ê¸°ì‹ ì´',
    r'ê²©êµ­ì´', r'ì‹ ê°•', r'ì‹ ì•½',
    r'í•©ì´', r'ì¶©ì´', r'í˜•ì´', r'íŒŒê°€', r'í•´ê°€',
    
    # í•œì í‘œí˜„
    r'[ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸]',
    r'[å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥]',
    r'[æœ¨ç«åœŸé‡‘æ°´]',
]


# ============ ì¹˜í™˜ í•¨ìˆ˜ ============

def replace_sipsung(text: str) -> str:
    """ì‹­ì„± ìš©ì–´ë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ë¡œ ì¹˜í™˜"""
    result = text
    for saju_term, business_terms in SIPSUNG_MAP.items():
        # ë‹¤ì–‘í•œ í˜•íƒœë¡œ ì¹˜í™˜ (ë¬¸ë§¥ì— ë§ê²Œ ì²« ë²ˆì§¸ ë˜ëŠ” ëœë¤)
        business_term = business_terms[0]
        
        # "OOìš´" íŒ¨í„´
        result = re.sub(
            rf'{saju_term}ìš´',
            f'{business_term} ì‚¬ì´í´',
            result
        )
        # "OOì´/ê°€" íŒ¨í„´
        result = re.sub(
            rf'{saju_term}[ì´ê°€ì€ëŠ”ì„ë¥¼]',
            f'{business_term}ì´ ',
            result
        )
        # ë‹¨ë… ì‚¬ìš©
        result = re.sub(
            rf'\b{saju_term}\b',
            business_term,
            result
        )
    
    return result


def replace_misc_terms(text: str) -> str:
    """ê¸°íƒ€ ëª…ë¦¬í•™ ìš©ì–´ ì¹˜í™˜"""
    result = text
    for saju_term, business_term in MISC_MAP.items():
        result = re.sub(
            rf'\b{saju_term}\b',
            business_term,
            result
        )
    return result


def replace_ohang(text: str) -> str:
    """ì˜¤í–‰ ìš©ì–´ ì¹˜í™˜"""
    result = text
    for saju_term, business_term in OHANG_MAP.items():
        result = re.sub(
            rf'{saju_term}[ì˜ì—]?\s*ê¸°ìš´',
            business_term,
            result
        )
        result = re.sub(
            rf'\b{saju_term}ê¸°\b',
            business_term,
            result
        )
    return result


def remove_ganji_references(text: str) -> str:
    """60ê°‘ì ì§ì ‘ ì°¸ì¡° ì œê±° (ë¬¸ë§¥ íŒŒê´´ ì—†ì´)"""
    result = text
    for ganji in GANJI_60:
        # "OOë…„/ì›”/ì¼" í˜•íƒœëŠ” "í•´ë‹¹ ì‹œê¸°"ë¡œ ì¹˜í™˜
        result = re.sub(
            rf'{ganji}(?:ë…„|ì›”|ì¼)',
            'í•´ë‹¹ ì‹œê¸°',
            result
        )
        # ë‹¨ë… ì‚¬ìš©ì€ ì œê±°
        result = re.sub(
            rf'\b{ganji}\b',
            '',
            result
        )
    return result


def remove_forbidden_patterns(text: str) -> str:
    """ê¸ˆì¹™ì–´ íŒ¨í„´ ì œê±°/ì¹˜í™˜"""
    result = text
    for pattern in FORBIDDEN_PATTERNS:
        result = re.sub(pattern, '', result)
    
    # ë¹ˆ ê´„í˜¸, ì—°ì† ê³µë°± ì •ë¦¬
    result = re.sub(r'\(\s*\)', '', result)
    result = re.sub(r'\s{2,}', ' ', result)
    result = re.sub(r'\n{3,}', '\n\n', result)
    
    return result.strip()


def sanitize_for_business(text: str, aggressive: bool = True) -> str:
    """
    ëª…ë¦¬í•™ ìš©ì–´ë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ë¡œ ì „í™˜í•˜ëŠ” ë©”ì¸ í•¨ìˆ˜
    
    Args:
        text: ì›ë³¸ í…ìŠ¤íŠ¸
        aggressive: Trueë©´ ê°•ë ¥ ì¹˜í™˜, Falseë©´ ë¶€ë“œëŸ¬ìš´ ì¹˜í™˜
    
    Returns:
        ì¹˜í™˜ëœ ë¹„ì¦ˆë‹ˆìŠ¤ í…ìŠ¤íŠ¸
    """
    if not text:
        return text
    
    result = text
    
    # ğŸ”¥ P0: RC-#### ë‚´ë¶€ ë©”ëª¨ ì œê±° (í”„ë¡ íŠ¸ ë…¸ì¶œ ê¸ˆì§€)
    result = re.sub(r'RC-\d{4}', '', result)
    result = re.sub(r'\[RC-\d{4}\]', '', result)
    result = re.sub(r'\(RC-\d{4}\)', '', result)
    
    # ğŸ”¥ P0: ì¶”ìƒì–´ ì œê±° (ì¼ë°˜ë¡  ê¸ˆì§€)
    abstract_phrases = [
        r'ë…¸ë ¥í•˜ì„¸ìš”', r'ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤', r'ë…¸ë ¥í•´ì•¼ í•©ë‹ˆë‹¤',
        r'ì„±ì¥ì˜ ì‹œê¸°', r'ì„±ì¥ê¸°', r'ë°œì „ì˜ ì‹œê¸°',
        r'ê· í˜•ì„ ìœ ì§€', r'ê· í˜•ì´ ì¤‘ìš”', r'ê· í˜• ì¡íŒ',
        r'ì¢‹ì€ ìš´', r'ìš´ì´ ì¢‹', r'í–‰ìš´',
        r'ì£¼ì˜ê°€ í•„ìš”', r'ì¡°ì‹¬í•´ì•¼', r'ìœ ì˜í•˜ì„¸ìš”',
    ]
    for phrase in abstract_phrases:
        result = re.sub(phrase, '', result)
    
    # 1ë‹¨ê³„: ì‹­ì„± ì¹˜í™˜ (ê°€ì¥ ì¤‘ìš”)
    result = replace_sipsung(result)
    
    # 2ë‹¨ê³„: ê¸°íƒ€ ëª…ë¦¬ ìš©ì–´ ì¹˜í™˜
    result = replace_misc_terms(result)
    
    # 3ë‹¨ê³„: ì˜¤í–‰ ì¹˜í™˜
    result = replace_ohang(result)
    
    # 4ë‹¨ê³„: 60ê°‘ì ì°¸ì¡° ì œê±°
    if aggressive:
        result = remove_ganji_references(result)
    
    # 5ë‹¨ê³„: ê¸ˆì¹™ì–´ ìµœì¢… ì œê±°
    result = remove_forbidden_patterns(result)
    
    # 6ë‹¨ê³„: ì •ë¦¬ (ì—°ì† ê³µë°±, ë¹ˆ ì¤„)
    result = re.sub(r'\s{2,}', ' ', result)
    result = re.sub(r'\n{3,}', '\n\n', result)
    result = result.strip()
    
    return result


def get_business_prompt_rules() -> str:
    """GPT í”„ë¡¬í”„íŠ¸ì— í¬í•¨í•  ìš©ì–´ ê·œì¹™"""
    return """
## ğŸš¨ í•„ìˆ˜ ìš©ì–´ ê·œì¹™ (ìœ„ë°˜ ì‹œ ì¬ì‘ì„±)

### ì ˆëŒ€ ê¸ˆì§€ ìš©ì–´ (ë³¸ë¬¸ì— ì‚¬ìš© ê¸ˆì§€)
- ì‹­ì„±: ë¹„ê², ë¹„ê²¬, ê²ì¬, ì¸ì„±, ì •ì¸, í¸ì¸, ì¬ì„±, ì •ì¬, í¸ì¬, ê´€ì„±, ì •ê´€, í¸ê´€, ì¹ ì‚´, ì‹ìƒ, ì‹ì‹ , ìƒê´€
- ê°„ì§€: ê°‘ì„ë³‘ì •ë¬´ê¸°ê²½ì‹ ì„ê³„ + ìì¶•ì¸ë¬˜ì§„ì‚¬ì˜¤ë¯¸ì‹ ìœ ìˆ í•´ ì¡°í•© (ì˜ˆ: ê°‘ì, ì„ì¶•, ë³‘ì¸, ì •ì‚¬, ë¬´ì¸ ë“±)
- ëª…ë¦¬í•™ ìš©ì–´: ì‚¬ì£¼, íŒ”ì, ìš´ì„¸, ëª…ë¦¬, ìŒì–‘ì˜¤í–‰, ì²œê°„ì§€ì§€, ëŒ€ìš´, ì„¸ìš´, ì›”ìš´, ìš©ì‹ , í¬ì‹ , ê¸°ì‹ , ê²©êµ­, ì‹ ê°•, ì‹ ì•½, í•©ì¶©í˜•íŒŒí•´
- í•œì í‘œê¸°: ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸, å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥, æœ¨ç«åœŸé‡‘æ°´

### í•„ìˆ˜ ì¹˜í™˜ ê·œì¹™
| ëª…ë¦¬ ìš©ì–´ | â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ |
|-----------|-----------------|
| ë¹„ê²/ë¹„ê²¬/ê²ì¬ | ê²½ìŸ êµ¬ë„, íŒŒíŠ¸ë„ˆì‹­ ì—­í•™, ì‹œì¥ ê²½ìŸ |
| ì¸ì„±/ì •ì¸/í¸ì¸ | ì§€ì‹ ìì‚°, IP, ë¸Œëœë“œ ì‹ ë¢°ë„, í•™ìŠµ ì—­ëŸ‰ |
| ì¬ì„±/ì •ì¬/í¸ì¬ | í˜„ê¸ˆíë¦„, ìœ ë™ì„±, ë§¤ì¶œ êµ¬ì¡°, ìì‚° |
| ê´€ì„±/ì •ê´€/í¸ê´€ | ì¡°ì§ ì‹œìŠ¤í…œ, ì»´í”Œë¼ì´ì–¸ìŠ¤, ë¦¬ìŠ¤í¬ ê´€ë¦¬ |
| ì‹ìƒ/ì‹ì‹ /ìƒê´€ | ì‹¤í–‰ë ¥, ìƒì‚°ì„±, ë§ˆì¼€íŒ…, ê¸°ìˆ í˜ì‹  |
| ìš©ì‹  | í•µì‹¬ ì„±ê³µ ìš”ì¸(CSF) |
| ëŒ€ìš´/ì„¸ìš´ | ì¥ê¸°/ì—°ê°„ ë¹„ì¦ˆë‹ˆìŠ¤ ì‚¬ì´í´ |
| ê¸¸í‰ | ê¸°íšŒì™€ ìœ„í˜‘ |

### ì‘ì„± í†¤
- ë§¥í‚¨ì§€/BCG ì»¨ì„¤íŒ… ë³´ê³ ì„œ ìŠ¤íƒ€ì¼
- ë°ì´í„° ê¸°ë°˜, ì‹¤í–‰ ê°€ëŠ¥í•œ ì œì•ˆ
- êµ¬ì²´ì  ìˆ«ì, ë‚ ì§œ, KPI ëª…ì‹œ
- ì‚¬ì£¼ í’€ì´ê°€ ì•„ë‹Œ 'ê²½ì˜ ì „ëµ ë³´ê³ ì„œ'
"""


def validate_no_forbidden_terms(text: str) -> Tuple[bool, List[str]]:
    """
    í…ìŠ¤íŠ¸ì— ê¸ˆì¹™ì–´ê°€ ìˆëŠ”ì§€ ê²€ì¦
    
    Returns:
        (í†µê³¼ ì—¬ë¶€, ë°œê²¬ëœ ê¸ˆì¹™ì–´ ë¦¬ìŠ¤íŠ¸)
    """
    found_terms = []
    
    # ì‹­ì„± ì²´í¬
    for term in SIPSUNG_MAP.keys():
        if term in text:
            found_terms.append(f"ì‹­ì„±:{term}")
    
    # 60ê°‘ì ì²´í¬
    for ganji in GANJI_60:
        if ganji in text:
            found_terms.append(f"ê°„ì§€:{ganji}")
    
    # ê¸°íƒ€ ëª…ë¦¬ ìš©ì–´ ì²´í¬
    for term in list(MISC_MAP.keys())[:20]:  # ì£¼ìš” ìš©ì–´ë§Œ
        if term in text and term not in ["í•©", "íŒŒ"]:  # ì¼ë°˜ ë‹¨ì–´ ì œì™¸
            found_terms.append(f"ëª…ë¦¬:{term}")
    
    # í•œì ì²´í¬
    hanja_pattern = r'[ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥æœ¨ç«åœŸé‡‘æ°´]'
    if re.search(hanja_pattern, text):
        found_terms.append("í•œì ë°œê²¬")
    
    return len(found_terms) == 0, found_terms


# ============ í…ŒìŠ¤íŠ¸ ============

if __name__ == "__main__":
    test_text = """
    2026ë…„ì—ëŠ” ë¹„ê²ìš´ì´ ê°•í•˜ê²Œ ì‘ìš©í•˜ì—¬ ê²½ìŸì´ ì¹˜ì—´í•´ì§‘ë‹ˆë‹¤.
    ì •ì¬ê°€ ë“¤ì–´ì˜¤ëŠ” ì‹œê¸°ì´ë¯€ë¡œ ì¬ë¬¼ìš´ì´ ì¢‹ìŠµë‹ˆë‹¤.
    ë¬´ì¸ë…„ì˜ ì˜í–¥ìœ¼ë¡œ ì‹ìƒì´ í™œë°œí•´ì ¸ ì°½ì‘ í™œë™ì— ìœ ë¦¬í•©ë‹ˆë‹¤.
    ëŒ€ìš´ì—ì„œ ì •ê´€ì´ ë“¤ì–´ì™€ ì§ì¥ì—ì„œ ìŠ¹ì§„ ê¸°íšŒê°€ ìˆìŠµë‹ˆë‹¤.
    """
    
    print("=== ì›ë³¸ ===")
    print(test_text)
    print("\n=== ì¹˜í™˜ í›„ ===")
    print(sanitize_for_business(test_text))
    
    print("\n=== ê²€ì¦ ===")
    is_valid, found = validate_no_forbidden_terms(test_text)
    print(f"ì›ë³¸ ê²€ì¦: í†µê³¼={is_valid}, ë°œê²¬={found}")
    
    sanitized = sanitize_for_business(test_text)
    is_valid2, found2 = validate_no_forbidden_terms(sanitized)
    print(f"ì¹˜í™˜í›„ ê²€ì¦: í†µê³¼={is_valid2}, ë°œê²¬={found2}")
